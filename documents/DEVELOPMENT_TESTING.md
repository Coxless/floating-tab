# 開発段階での動作確認手順書

## 1. 環境準備

### 1.1 必要なツール

- Node.js (v24以上推奨)
- pnpm (v10.28.0)
- Google Chrome (最新版)

### 1.2 依存関係のインストール

```bash
pnpm install
```

## 2. ビルド

```bash
pnpm build
```

起動後、`dist/` ディレクトリにビルド成果物が生成されます。

## 3. Chrome拡張機能の読み込み

1. Chromeで `chrome://extensions` を開く
2. 右上の「デベロッパーモード」をONにする
3. 「パッケージ化されていない拡張機能を読み込む」をクリック
4. プロジェクトの `dist/` ディレクトリを選択
5. 「floating-tab」が拡張機能一覧に表示されることを確認

## 4. 動作確認チェックリスト

### 4.1 基本動作

| # | 確認項目 | 手順 | 期待結果 |
|---|----------|------|----------|
| 1 | 拡張機能の読み込み | chrome://extensionsで確認 | エラーなく読み込まれている |
| 2 | ショートカット起動 | 任意のページで `Ctrl+Alt+Space` を押す | フローティングポップアップが表示される |
| 3 | ポップアップ閉じる | `Ctrl+Alt+Space` または `Escape` を押す | ポップアップが閉じる |
| 4 | 拡張機能アイコンクリック | ツールバーのアイコンをクリック | ポップアップが表示される |

### 4.2 タブ検索機能

| # | 確認項目 | 手順 | 期待結果 |
|---|----------|------|----------|
| 1 | タブ一覧表示 | ポップアップを開く | 現在開いているタブが一覧表示される |
| 2 | 検索フィルタ | 検索ボックスに文字を入力 | タイトルまたはURLにマッチするタブのみ表示 |
| 3 | 検索クリア | 検索ボックスをクリア | 全タブが表示される |

### 4.3 タブ操作

| # | 確認項目 | 手順 | 期待結果 |
|---|----------|------|----------|
| 1 | タブ切り替え (クリック) | タブアイテムをクリック | 該当タブがアクティブになる |
| 2 | タブ切り替え (キーボード) | `↑/↓` で選択し `Enter` | 該当タブがアクティブになる |
| 3 | 現在のタブ表示 | ポップアップを開く | 現在のタブがハイライトされている |

### 4.4 キーボードナビゲーション

| # | 確認項目 | 手順 | 期待結果 |
|---|----------|------|----------|
| 1 | 上キー | `↑` を押す | 選択が1つ上に移動 |
| 2 | 下キー | `↓` を押す | 選択が1つ下に移動 |
| 3 | ループ | 先頭/末尾で `↑/↓` | 末尾/先頭にループする |
| 4 | Enter確定 | タブ選択状態で `Enter` | 選択タブに切り替わる |
| 5 | Escape | `Escape` を押す | ポップアップが閉じる |

### 4.5 全画面モード (F11)

| # | 確認項目 | 手順 | 期待結果 |
|---|----------|------|----------|
| 1 | 全画面でのショートカット | `F11` で全画面 → `Ctrl+Alt+Space` | ポップアップが表示される |
| 2 | 全画面でのタブ切り替え | 全画面中にタブを切り替え | 正常にタブが切り替わる |

### 4.6 UIの見た目

| # | 確認項目 | 期待結果 |
|---|----------|----------|
| 1 | ポップアップ位置 | 画面中央に表示される |
| 2 | ファビコン表示 | 各タブのファビコンが表示される |
| 3 | タブタイトル | 長いタイトルは省略表示 (ellipsis) |
| 4 | ホバー状態 | マウスオーバーで背景色が変わる |
| 5 | フォーカス状態 | キーボード選択中のタブがハイライト |

## 5. 特殊ケースの確認

### 5.1 制限ページ

以下のページではContent Scriptが動作しないため、ショートカットが効かない場合があります:

- `chrome://` で始まるページ (設定、拡張機能ページ等)
- `chrome-extension://` で始まるページ
- Chrome Web Store (`chrome.google.com/webstore`)

### 5.2 エッジケース

| # | 確認項目 | 手順 | 期待結果 |
|---|----------|------|----------|
| 1 | タブなし | 全タブを閉じた状態 | 空状態のメッセージが表示 |
| 2 | 多数のタブ | 20個以上タブを開く | スクロール可能なリスト表示 |
| 3 | 特殊文字タイトル | 絵文字や記号を含むページ | 正常に表示される |

## 6. トラブルシューティング

### ポップアップが表示されない

1. `chrome://extensions` でエラーがないか確認
2. Service Workerの「検証」をクリックしてコンソールエラーを確認
3. 該当ページの DevTools でContent Scriptのエラーを確認
4. ショートカットが他の拡張機能と競合していないか確認
   - `chrome://extensions/shortcuts` で確認可能

### タブ一覧が取得できない

1. `tabs` 権限が付与されているか確認
2. Service Workerが起動しているか確認 (chrome://extensions)

### スタイルが崩れる

1. Shadow DOMが正しく動作しているか確認
2. ホストページのCSSがリークしていないか確認

### 変更が反映されない

1. 拡張機能を再読み込み (chrome://extensions の更新ボタン)
2. ブラウザキャッシュをクリア
3. `dist/` を削除して再ビルド

```bash
rm -rf dist && pnpm build
```
